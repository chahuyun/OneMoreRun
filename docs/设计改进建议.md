# 设计改进建议（OneMoreRun）

面向后续演进的结构与功能建议，按优先级归类，便于逐步实现。

## 战斗与技能
- 冷却与资源：在 `Skills` 增加冷却计时和资源（法力/能量）消耗，`GameProcess` 中在施放前检查，并在回合结束递减冷却。
- 多技能与权重：为玩家/Boss 支持技能列表轮替或权重选择，避免只取第一个技能。
- 目标选择策略：把 `selectTargets` 拆到策略类/接口，便于按技能配置或 AI 规则扩展（仇恨、血量最低、职业优先等）。
- Buff/Debuff 生命周期：为 `Effect` 增加回合计数与自动移除，支持叠加/覆盖策略（如同类型只保留最高优先级）。
- 触发链与优先级：在伤害结算时对效果按 `priority` 排序，区分前置（减伤/免疫）与后置（反弹/溅射）。

## 属性与数值
- 伤害公式统一：抽取伤害/减伤公式，支持暴击、命中/闪避、抗性，减少各处硬编码。
- 状态快照：在回合开始时记录状态，用于日志和回放，便于调试数值问题。
- 随机可重复：引入可配置随机种子，方便测试复现。

## 数据与配置
- 数据驱动：副本/装备/技能/效果尽量数据化（JSON/YAML），代码只做装配与校验，减少硬编码。
- 配置校验：启动时对 code 唯一性、必填字段、掉落权重等做校验，提前报错。
- 本地/测试数据库：支持 H2/SQLite 测试模式，便于无 MySQL 环境下跑用例。

## 日志与可观测性
- 结构化日志：对战斗关键节点（施放、命中、暴击、效果触发）输出结构化消息，便于排查。
- 录制与重放：可选记录一局对战输入（队伍/副本/随机种子）与过程，支持重放验证。

## 测试与工具
- 最小集成测试：构造 3 玩家 + 起始副本的流程测试，验证不抛异常且日志包含关键节点。
- 单元测试：针对公式、掉落权重、效果触发顺序做小型测试，防回归。
- 负载/压力：简单多局模拟（无需 Mirai），验证内存与随机流程稳定性。

## 插件与指令
- 指令防抖与提示：对重复入队/已在战斗等场景友好提示；队伍状态查询指令。
- 权限分级：为测试/管理员提供快速建队、跳过选择、副本直启的调试指令。

## 结构整理
- 分层清晰：将战斗流程、AI/目标选择、数值计算、效果处理拆分模块，减少 `GameProcess` 体积。
- 工厂与注册器：保持集中注册，并提供重载/刷新机制（热重载时重新注册/校验）。

## 文档与示例
- 增补“最小可运行示例”指南：一步步从配置数据库到发指令开一把的流程，含常见错误排查。
- 为技能/效果再补 1~2 个示例（含带效果的技能、带持续时间的 buff），对照触发时机说明。


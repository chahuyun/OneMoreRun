# 技能开发指南（面向 Kotlin 新手）

帮助你理解示例技能，知道为什么这么写，以及如何添加新技能。

## 技能类长什么样
- 基类：`Skills`（抽象类）
  - 关键字段：`code`（唯一）、`name`、`description`、`skillsType`（职业/自定义/被动）、`target`（目标类型）、`cooldown`
  - 必须实现：
    - `getEffectCodes(): List<String>` 释放时要附加的效果 code 列表
    - `getImpactConfigs(): List<ImpactConfig>` 伤害/治疗配置（包含伤害类型和公式）
- 作用：把“释放时做什么”拆为两块——附加效果、造成数值影响。

## 现有示例
- `FireballSkills`（玩家版）：物理伤害 = 1.5×ATK，冷却 2，目标 Boss，效果列表为空。
- `FireballSkills`（Boss 版）：物理伤害 = 1.2×ATK，冷却 2，目标全体玩家（`ALL_PLAYERS`），供 Boss 使用。
- Registrar `FireballSkillsRegistrar`：`init` 中同时注册玩家版与 Boss 版；`StartingZone` 难度 3 为 Boss 配置 Boss 版火焰术。

## 为什么这么设计
- 数据与逻辑解耦：技能只描述“附加哪些效果、怎么算伤害”，释放逻辑在 `GameProcess.castSkill` 里统一处理。
- 目标类型枚举 `TargetType`：保证选择目标的策略统一（SELF/BOSS/ALL_PLAYERS 等）。
- 工厂注册：统一管理，避免重复 code；未注册直接报错，方便早期发现问题。

## 我想写一个新技能，步骤
1) 新建类继承 `Skills`，定义唯一 `code`、`name`、`description`、`skillsType`、`target`、`cooldown`。
2) `getEffectCodes()`：返回需要附加的效果 code（如点燃、中毒等）；若无则返回空列表。
3) `getImpactConfigs()`：返回伤害/治疗配置，示例：
   ```kotlin
   ImpactConfig(
       DamageType.MAGIC,
       calculateBaseValue = { self, targets ->
           (self.atk * 2.0f).roundToInt() // 2 倍攻
       }
   )
   ```
4) 在 Registrar（`object XxxSkillsRegistrar`）里 `SkillsFactory.register(NewSkill(...))`。
5) 在副本或玩家数据里引用技能 code（如副本的 `skills[difficulty]`，或用户技能栏）。

## 规范建议
- code：`S-<主题>-<强度>` 或类似规则，保持唯一。
- 目标类型：按需求挑选最贴近的 `TargetType`，简化当前逻辑已支持常见单体/群体。
- 计算公式：先做简单乘系数，等验证通过再引入暴击/命中等复杂逻辑。
- 冷却：目前流程未严格实现冷却，仅保留字段；后续可在 `GameProcess` 中扩展冷却检查。

## 常见问题
- “技能没释放”：确认技能已注册，且被玩家/Boss 持有（玩家从 `skillsColumn` 载入，Boss 从副本 `skills`）。
- “效果不生效”：确保 `getEffectCodes()` 返回的效果已注册；触发时机匹配需要的 `Trigger`。
- “目标不对”：检查 `TargetType` 选择逻辑（如 BOSS/ALLY/ALL_PLAYERS）；当前简化实现只取第一个技能并按目标类型选目标。


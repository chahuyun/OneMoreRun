# 副本开发指南（面向 Kotlin 新手）

面向入门者，讲清楚“为什么这样写、能实现什么、想做新副本怎么做”。

## 副本类长什么样
- 基类：`Dungeon`（抽象类），需要提供
  - `code`/`name`/`bossName`/`bossDescription`
  - `bossProperty`：难度 -> Boss 属性
  - `skills`：难度 -> Boss 技能 code 列表
  - `dropLoot`：难度 -> 掉落堆列表
  - `certainlyLoot`：难度 -> 必掉列表
- 作用：把“同一个副本的不同难度配置”集中在一处；`toBoss(difficulty)` 会按难度生成 `Boss`。

## 现有示例：`StartingZone`
- 代码位置：`dungeon/StartingZone.kt`
- 做的事：
  - 定义新手村 Boss 不同难度的属性与技能（难度 3 有火球）。
  - 配置掉落（难度 1/2 固定头盔；难度 3 有头盔/戒指/空掉落的权重）。
  - 在 `StartingZoneRegistrar` 注册到 `DungeonFactory`，供游戏启动时加载。

## 为什么要这么分层
- 抽象类 `Dungeon`：统一接口，后续新副本只改数据，不动流程。
- Registrar（注册器）：集中加载，避免到处散落 `register` 调用。
- `bossProperty` 用 Map：天然支持多难度，缺失难度会抛异常，强迫补齐配置。

## 我想写一个新副本，步骤
1) 新建类继承 `Dungeon`，准备好唯一 `code`（如 `D-forest-1`），写清楚 Boss 名称/描述。
2) 填 `bossProperty`：用 `BaseProperty.create(hp, atk, def, crit, critDamage)`。
3) 填 `skills`：按难度列出技能 code（需先有技能并注册到 `SkillsFactory`）。
4) 填 `dropLoot`：用 `buildLootHeapList { lootHeap { ... } }` 组合掉落；必掉用 `certainlyLoot`。
5) 写一个 `XXXRegistrar` `object`，`init` 里 `DungeonFactory.register(yourDungeon)`。
6) 在 `OMRLoader.loader()` 的 `loaderDungeon()` 中确保 Registrar 被引用（只需 `YourRegistrar` 即可触发 `init`）。

## 规范建议
- code：`D-<主题>-<序号>`，唯一且稳定。
- 描述：`bossDescription` 写清外观/特征，方便文案输出。
- 难度覆盖：若开放 1~3 难度，`bossProperty`/`skills`/`dropLoot` 至少覆盖存在的难度 key。
- 掉落权重：`lootHeap { equipment(70, code) ; none(20) ; gold(10, 50) }` 形式简单直观。

## 常见问题
- “Boss 没技能”：确认 `skills[difficulty]` 是否包含技能 code，且技能已注册。
- “拿不到副本”：`DungeonFactory.getByName` 是按 name 匹配，name 要可读且唯一；code 只在注册和内部用。
- “难度报错”：`GameProcess` 会在 `bossProperty` 缺失时抛异常，补齐对应难度即可。





# 装备开发指南（面向 Kotlin 新手）

目标：让你看懂示例装备，知道为什么这样写，以及如何自己做新装备。

## 装备类长什么样
- 基类：`Equipment`（抽象类）
  - 必填：`code`（唯一）、`name`、`description`、`slot`（部位）
  - 可选：`suit`（套装）、`special`（是否有特殊效果逻辑）、`random`（是否随机属性）
  - 必须实现：
    - `generateProperties(): () -> List<Property>` 生成属性列表
    - `generateEffects(): () -> List<Effect>` 生成效果列表
- 作用：统一装备的属性/效果生成方式，支持序列化与随机实例。

## 现有示例
- `NoviceHelmet`：固定 DEF+1，新手套装一部分。
- `NoviceRing`：`random=true`，随机 ATK/DEF +3~5。
- 套装 `NoviceSuit`：5 件触发 ATK+5、DEF+5。
- 注册器 `NoviceEquipmentRegistrar`：在 `init` 里调用 `EquipmentFactory.register(...)`。

## 为什么要这样设计
- 抽象装备 + 工厂：避免到处 new；注册后用 `EquipmentFactory.take(code)` 获取，随机装备会克隆并落库。
- `@SerializeEquipment` + `@EquipmentDiscriminator`：标记可序列化类型，让随机装备能被正确反序列化。
- `generateProperties`/`generateEffects` 是函数属性：延迟生成，克隆时能得到独立副本。

## 我想写一个新装备，步骤
1) 新建类继承 `Equipment`，加注解 `@SerializeEquipment`、`@EquipmentDiscriminator("<唯一code>")`。
2) 填 constructor 参数：name/description/slot，必要时传入套装 `Suit`。
3) 实现 `generateProperties`：返回固定或随机属性；随机需设 `random=true`。
4) 实现 `generateEffects`：若需要闪避/中毒等效果，返回 `EffectFactory.take(code)` 的列表或空列表。
5) 写一个 Registrar `object`，`init` 里 `EquipmentFactory.register(YourEquipment())`。
6) 确保 Registrar 被 `OMRLoader.loader()` 调用（引用即可触发 `init`）。

## 规范建议
- code：`E-<主题>-<名称>`；随机实例会自动追加短 id（无需手动改）。
- 描述：`smallComposition` 可写长文案；`description` 保持一句话摘要。
- 属性生成：随机用 `Property.random(...)`；固定属性直接 `listOf(Property(5, ATK))`。
- 套装：`Suit` 的 `effectsMap`/`propertyMap` 以件数为 key；`piecesRequired` 表示最少触发件数。

## 常见问题
- “装备效果没生效”：确认 `generateEffects` 返回的效果是否已注册；战斗流程的效果触发时机是否匹配。
- “随机属性不变”：确保类的 `random=true`，并且使用 `EquipmentFactory.take(code)` 获取，而不是直接 new。
- “序列化失败”：检查是否加了 `@SerializeEquipment` 和 `@EquipmentDiscriminator`，以及 Registrar 是否注册过。

